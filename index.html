<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Links</title>
    <meta name="description" content="Links • A-Frame">
    <script src="src/aframe-master.js"></script>
    <script src="src/components/aframe-tooltip-component.js"></script>
    <script src="src/components/camera-position.js"></script>
    <script src="src/components/link-controls.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
    <script src="src/info-message.js"></script>
  </head>
  <body>
    <a-scene
      fog="color: #241417; near: 0; far: 30;"
      raycaster="far: 100; objects: [link];"
      cursor="rayOrigin: mouse"      <!-- ...existing code... -->
      <!DOCTYPE html>
      <html>
      <head>
          <meta charset="utf-8">
          <title>Meeting Room</title>
          <meta name="description" content="Meeting Room">
          <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
          <style>
              body {
                  margin: 0;
                  font-family: Arial, sans-serif;
              }
              
              #ui-controls {
                  position: fixed;
                  top: 20px;
                  left: 20px;
                  z-index: 1000;
                  background: rgba(0, 0, 0, 0.7);
                  padding: 15px;
                  border-radius: 10px;
                  color: white;
              }
              
              .control-button {
                  background: #4CAF50;
                  border: none;
                  color: white;
                  padding: 10px 15px;
                  margin: 5px;
                  border-radius: 5px;
                  cursor: pointer;
                  font-size: 14px;
                  transition: background-color 0.3s;
              }
              
              .control-button:hover {
                  background: #45a049;
              }
              
              .control-button.active {
                  background: #FF6B6B;
              }
      
              /* 新按钮被打开时的样式 */
              .control-button.model-active {
                  background: #FFB74D;
              }
              
              #info {
                  position: fixed;
                  bottom: 20px;
                  left: 20px;
                  z-index: 1000;
                  background: rgba(0, 0, 0, 0.7);
                  padding: 10px;
                  border-radius: 5px;
                  color: white;
                  font-size: 14px;
              }
              
              .hotspot {
                  cursor: pointer;
                  transition: all 0.3s ease;
              }
              
              .hotspot:hover {
                  transform: scale(1.2);
              }
          </style>
      </head>
      <body>
              <!-- 返回首页按钮 -->
          <div id="back-to-index" style="position: fixed; top: 20px; right: 20px; z-index: 1100;">
              <button onclick="window.location.href='../index.html';"
                      style="background:#283644;color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-size:15px;">
                  Back to Home Page
              </button>
          </div>
      
          <!-- UI 控制面板 -->
          <div id="ui-controls">
              <h3 style="margin: 0 0 10px 0;">view switch</h3>
              <button class="control-button active" onclick="switchView(0)">view 1</button>
              <button class="control-button" onclick="switchView(1)">view 2</button>
              <button class="control-button" onclick="switchView(2)">view 3</button>
      
              <!-- 新增：显示/隐藏 3D PLY 模型按钮 -->
              <div style="margin-top:8px;">
                  <button id="toggle-model-btn" class="control-button" onclick="toggleModel()">Show 3D Model</button>
              </div>
          </div>
          
          <!-- 信息面板 -->
          <div id="info">
              <div>current view: <span id="current-view">view 1</span></div>
              <div>use the mouse to click and scroll, click buttons for view switch</div>
          </div>
      
          <a-scene vr-mode-ui="enabled: false" background="color: #000">
              <!-- 资源预加载 -->
              <a-assets>
                  <!-- 示例图片资源 - 请替换为你的实际图片路径 -->
                  <img id="view1" src="../images/meeting room/leave room.jpg" crossorigin="anonymous">
                  <img id="view2" src="../images/meeting room/meet_view2.jpg" crossorigin="anonymous">
                  <img id="view3" src="../images/meeting room/meet_view3.jpg" crossorigin="anonymous">
      
                  <!-- 新增：PLY 模型资源（路径可根据实际位置调整；若文件名有空格，请保留或改为无空格） -->
                  <a-asset-item id="meeting-ply" src="../models/Meeting%20Room.ply"></a-asset-item>
              </a-assets>
      
              <!-- 全景天空盒 -->
              <a-sky id="panorama" 
                     src="#view1" 
                     rotation="0 -130 0"
                     animation__fade="property: material.opacity; 
                                      to: 1; 
                                      dur: 1000; 
                                      easing: easeInOutQuad">
              </a-sky>
      
              <!-- 热点容器，必须添加 -->
              <a-entity id="hotspots"></a-entity>
      
              <!-- 摄像机和控制器 -->
              <a-entity id="cameraRig" position="0 1.6 0">
                  <a-camera 
                      look-controls="enabled: true; pointerLockEnabled: false"
                      wasd-controls="enabled: false"
                      cursor="rayOrigin: mouse"
                      raycaster="objects: .hotspot">
                  </a-camera>
              </a-entity>
      
              <!-- 光照 -->
              <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
              <!-- 为模型添加方向光以便更好观察 -->
              <a-light type="directional" color="#ffffff" intensity="0.8" position="0 5 5"></a-light>
          </a-scene>
      
          <!-- PLYLoader: 使用 three.js Examples 的加载器（依赖全局 THREE） -->
          <script src="https://threejs.org/examples/js/loaders/PLYLoader.js"></script>
      
          <script>
              // 全景图片数据配置
              const viewsData = [
                  {
                      name: "view 1",
                      image: "#view1",
                      rotation: "0 -130 0",
                      hotspots: [
                          { position: "3 0 -3", target: 1, color: "#FF6B6B", label: "view 2" },
                          { position: "-3 0 -3", target: 2, color: "#4ECDC4", label: "view 3" }
                      ]
                  },
                  {
                      name: "view 2", 
                      image: "#view2",
                      rotation: "0 -90 0",
                      hotspots: [
                          { position: "-3 0 -3", target: 0, color: "#96CEB4", label: "view 1" },
                          { position: "3 0 -3", target: 2, color: "#4ECDC4", label: "view 3" }
                      ]
                  },
                  {
                      name: "view 3",
                      image: "#view3", 
                      rotation: "0 0 0",
                      hotspots: [
                          { position: "3 0 3", target: 0, color: "#96CEB4", label: "view 1" },
                          { position: "-3 0 3", target: 1, color: "#FF6B6B", label: "view 2" }
                      ]
                  },
              ];
      
              let currentViewIndex = 0;
      
              // 切换view函数
              function switchView(viewIndex) {
                  if (viewIndex === currentViewIndex) return;
                  
                  const viewData = viewsData[viewIndex];
                  const panorama = document.querySelector('#panorama');
                  const currentViewSpan = document.querySelector('#current-view');
                  
                  // 淡出效果
                  panorama.setAttribute('animation__fadeout', {
                      property: 'material.opacity',
                      to: 0,
                      dur: 500,
                      easing: 'easeInOutQuad'
                  });
                  
                  // 延迟切换图片和淡入
                  setTimeout(() => {
                      panorama.setAttribute('src', viewData.image);
                      panorama.setAttribute('rotation', viewData.rotation);
                      
                      panorama.setAttribute('animation__fadein', {
                          property: 'material.opacity',
                          to: 1,
                          dur: 500,
                          easing: 'easeInOutQuad'
                      });
                      
                      // 更新UI
                      updateUI(viewIndex);
                      updateHotspots(viewData.hotspots);
                      currentViewSpan.textContent = viewData.name;
                      
                  }, 500);
                  
                  currentViewIndex = viewIndex;
              }
      
              // 更新UI按钮状态
              function updateUI(activeIndex) {
                  const buttons = document.querySelectorAll('.control-button');
                  buttons.forEach((button, index) => {
                      // 保持模型按钮状态独立（model 按钮有 id）
                      if (button.id === 'toggle-model-btn') return;
                      button.classList.toggle('active', index === activeIndex);
                  });
              }
      
              // 更新热点位置和目标
              function updateHotspots(hotspots) {
                  const hotspotsContainer = document.querySelector('#hotspots');
                  hotspotsContainer.innerHTML = '';
                  
                  hotspots.forEach((hotspot, index) => {
                      const hotspotEl = document.createElement('a-sphere');
                      hotspotEl.setAttribute('class', 'hotspot');
                      hotspotEl.setAttribute('position', hotspot.position);
                      hotspotEl.setAttribute('radius', '0.2');
                      hotspotEl.setAttribute('color', hotspot.color);
                      hotspotEl.setAttribute('material', 'opacity: 0.8');
                      hotspotEl.setAttribute('animation__mouseenter', {
                          property: 'scale',
                          to: '1.3 1.3 1.3',
                          startEvents: 'mouseenter',
                          dur: 200
                      });
                      hotspotEl.setAttribute('animation__mouseleave', {
                          property: 'scale',
                          to: '1 1 1',
                          startEvents: 'mouseleave',
                          dur: 200
                      });
                      
                      // 添加点击事件
                      hotspotEl.addEventListener('click', () => switchView(hotspot.target));
                      
                      // 添加文字标签
                      const textEl = document.createElement('a-text');
                      textEl.setAttribute('value', hotspot.label);
                      textEl.setAttribute('position', '0 0.5 0');
                      textEl.setAttribute('align', 'center');
                      textEl.setAttribute('color', 'white');
                      textEl.setAttribute('scale', '2 2 2');
                      textEl.setAttribute('billboard', 'true');
                      
                      hotspotEl.appendChild(textEl);
                      hotspotsContainer.appendChild(hotspotEl);
                  });
              }
      
              // 键盘导航支持
              document.addEventListener('keydown', (event) => {
                  switch(event.key) {
                      case '1':
                          switchView(0);
                          break;
                      case '2':
                          switchView(1);
                          break;
                      case '3':
                          switchView(2);
                          break;
                      case 'ArrowLeft':
                          switchView((currentViewIndex - 1 + viewsData.length) % viewsData.length);
                          break;
                      case 'ArrowRight':
                          switchView((currentViewIndex + 1) % viewsData.length);
                          break;
                  }
              });
      
              // 初始化热点
              document.addEventListener('DOMContentLoaded', () => {
                  updateHotspots(viewsData[0].hotspots);
              });
      
              // -----------------------
              // PLY 模型加载组件与切换逻辑
              // -----------------------
              AFRAME.registerComponent('ply-model', {
                  schema: {
                      src: { type: 'string' } // 支持 asset id (#meeting-ply) 或 url
                  },
                  init: function () {
                      const src = this.data.src;
                      const loader = new THREE.PLYLoader();
                      const el = this.el;
      
                      // Resolve URL: 如果使用 asset id（以#开头），取 asset 的 src 属性
                      let url = src;
                      if (src && src.startsWith('#')) {
                          const asset = document.querySelector(src);
                          if (asset) url = asset.getAttribute('src');
                      }
      
                      if (!url) {
                          console.warn('ply-model: no src provided');
                          return;
                      }
      
                      loader.load(url, (geometry) => {
                          geometry.computeVertexNormals();
                          const material = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.1, roughness: 0.8 });
                          const mesh = new THREE.Mesh(geometry, material);
      
                          // 初始缩放/旋转可根据模型调整
                          mesh.scale.set(0.01, 0.01, 0.01);
                          mesh.rotation.x = -Math.PI/2;
      
                          el.setObject3D('mesh', mesh);
                      }, undefined, (err) => {
                          console.error('PLY load error:', err);
                      });
                  },
                  remove: function () {
                      this.el.removeObject3D('mesh');
                  }
              });
      
              // 切换 PLY 模型显示/隐藏
              let modelVisible = false;
              function toggleModel() {
                  const btn = document.querySelector('#toggle-model-btn');
                  const scene = document.querySelector('a-scene');
      
                  const existing = document.querySelector('#meeting-model');
                  if (existing) {
                      existing.parentNode.removeChild(existing);
                      modelVisible = false;
                      btn.textContent = 'Show 3D Model';
                      btn.classList.remove('model-active');
                      return;
                  }
      
                  const modelEntity = document.createElement('a-entity');
                  modelEntity.setAttribute('id', 'meeting-model');
                  // 使用预加载的 asset id
                  modelEntity.setAttribute('ply-model', 'src: #meeting-ply');
                  // 放在相机前方 2 米处，可根据需要调整位置/缩放/旋转
                  modelEntity.setAttribute('position', '0 0 -2');
                  modelEntity.setAttribute('rotation', '0 0 0');
                  // scale 可以微调，组件内也做了基础缩放
                  modelEntity.setAttribute('scale', '1 1 1');
      
                  scene.appendChild(modelEntity);
                  modelVisible = true;
                  btn.textContent = 'Hide 3D Model';
                  btn.classList.add('model-active');
              }
          </script>
      </body>
      </html>
      <!-- ...existing code... -->      <!-- ...existing code... -->
      <!DOCTYPE html>
      <html>
      <head>
          <meta charset="utf-8">
          <title>Meeting Room</title>
          <meta name="description" content="Meeting Room">
          <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
          <style>
              body {
                  margin: 0;
                  font-family: Arial, sans-serif;
              }
              
              #ui-controls {
                  position: fixed;
                  top: 20px;
                  left: 20px;
                  z-index: 1000;
                  background: rgba(0, 0, 0, 0.7);
                  padding: 15px;
                  border-radius: 10px;
                  color: white;
              }
              
              .control-button {
                  background: #4CAF50;
                  border: none;
                  color: white;
                  padding: 10px 15px;
                  margin: 5px;
                  border-radius: 5px;
                  cursor: pointer;
                  font-size: 14px;
                  transition: background-color 0.3s;
              }
              
              .control-button:hover {
                  background: #45a049;
              }
              
              .control-button.active {
                  background: #FF6B6B;
              }
      
              /* 新按钮被打开时的样式 */
              .control-button.model-active {
                  background: #FFB74D;
              }
              
              #info {
                  position: fixed;
                  bottom: 20px;
                  left: 20px;
                  z-index: 1000;
                  background: rgba(0, 0, 0, 0.7);
                  padding: 10px;
                  border-radius: 5px;
                  color: white;
                  font-size: 14px;
              }
              
              .hotspot {
                  cursor: pointer;
                  transition: all 0.3s ease;
              }
              
              .hotspot:hover {
                  transform: scale(1.2);
              }
          </style>
      </head>
      <body>
              <!-- 返回首页按钮 -->
          <div id="back-to-index" style="position: fixed; top: 20px; right: 20px; z-index: 1100;">
              <button onclick="window.location.href='../index.html';"
                      style="background:#283644;color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-size:15px;">
                  Back to Home Page
              </button>
          </div>
      
          <!-- UI 控制面板 -->
          <div id="ui-controls">
              <h3 style="margin: 0 0 10px 0;">view switch</h3>
              <button class="control-button active" onclick="switchView(0)">view 1</button>
              <button class="control-button" onclick="switchView(1)">view 2</button>
              <button class="control-button" onclick="switchView(2)">view 3</button>
      
              <!-- 新增：显示/隐藏 3D PLY 模型按钮 -->
              <div style="margin-top:8px;">
                  <button id="toggle-model-btn" class="control-button" onclick="toggleModel()">Show 3D Model</button>
              </div>
          </div>
          
          <!-- 信息面板 -->
          <div id="info">
              <div>current view: <span id="current-view">view 1</span></div>
              <div>use the mouse to click and scroll, click buttons for view switch</div>
          </div>
      
          <a-scene vr-mode-ui="enabled: false" background="color: #000">
              <!-- 资源预加载 -->
              <a-assets>
                  <!-- 示例图片资源 - 请替换为你的实际图片路径 -->
                  <img id="view1" src="../images/meeting room/leave room.jpg" crossorigin="anonymous">
                  <img id="view2" src="../images/meeting room/meet_view2.jpg" crossorigin="anonymous">
                  <img id="view3" src="../images/meeting room/meet_view3.jpg" crossorigin="anonymous">
      
                  <!-- 新增：PLY 模型资源（路径可根据实际位置调整；若文件名有空格，请保留或改为无空格） -->
                  <a-asset-item id="meeting-ply" src="../models/Meeting%20Room.ply"></a-asset-item>
              </a-assets>
      
              <!-- 全景天空盒 -->
              <a-sky id="panorama" 
                     src="#view1" 
                     rotation="0 -130 0"
                     animation__fade="property: material.opacity; 
                                      to: 1; 
                                      dur: 1000; 
                                      easing: easeInOutQuad">
              </a-sky>
      
              <!-- 热点容器，必须添加 -->
              <a-entity id="hotspots"></a-entity>
      
              <!-- 摄像机和控制器 -->
              <a-entity id="cameraRig" position="0 1.6 0">
                  <a-camera 
                      look-controls="enabled: true; pointerLockEnabled: false"
                      wasd-controls="enabled: false"
                      cursor="rayOrigin: mouse"
                      raycaster="objects: .hotspot">
                  </a-camera>
              </a-entity>
      
              <!-- 光照 -->
              <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
              <!-- 为模型添加方向光以便更好观察 -->
              <a-light type="directional" color="#ffffff" intensity="0.8" position="0 5 5"></a-light>
          </a-scene>
      
          <!-- PLYLoader: 使用 three.js Examples 的加载器（依赖全局 THREE） -->
          <script src="https://threejs.org/examples/js/loaders/PLYLoader.js"></script>
      
          <script>
              // 全景图片数据配置
              const viewsData = [
                  {
                      name: "view 1",
                      image: "#view1",
                      rotation: "0 -130 0",
                      hotspots: [
                          { position: "3 0 -3", target: 1, color: "#FF6B6B", label: "view 2" },
                          { position: "-3 0 -3", target: 2, color: "#4ECDC4", label: "view 3" }
                      ]
                  },
                  {
                      name: "view 2", 
                      image: "#view2",
                      rotation: "0 -90 0",
                      hotspots: [
                          { position: "-3 0 -3", target: 0, color: "#96CEB4", label: "view 1" },
                          { position: "3 0 -3", target: 2, color: "#4ECDC4", label: "view 3" }
                      ]
                  },
                  {
                      name: "view 3",
                      image: "#view3", 
                      rotation: "0 0 0",
                      hotspots: [
                          { position: "3 0 3", target: 0, color: "#96CEB4", label: "view 1" },
                          { position: "-3 0 3", target: 1, color: "#FF6B6B", label: "view 2" }
                      ]
                  },
              ];
      
              let currentViewIndex = 0;
      
              // 切换view函数
              function switchView(viewIndex) {
                  if (viewIndex === currentViewIndex) return;
                  
                  const viewData = viewsData[viewIndex];
                  const panorama = document.querySelector('#panorama');
                  const currentViewSpan = document.querySelector('#current-view');
                  
                  // 淡出效果
                  panorama.setAttribute('animation__fadeout', {
                      property: 'material.opacity',
                      to: 0,
                      dur: 500,
                      easing: 'easeInOutQuad'
                  });
                  
                  // 延迟切换图片和淡入
                  setTimeout(() => {
                      panorama.setAttribute('src', viewData.image);
                      panorama.setAttribute('rotation', viewData.rotation);
                      
                      panorama.setAttribute('animation__fadein', {
                          property: 'material.opacity',
                          to: 1,
                          dur: 500,
                          easing: 'easeInOutQuad'
                      });
                      
                      // 更新UI
                      updateUI(viewIndex);
                      updateHotspots(viewData.hotspots);
                      currentViewSpan.textContent = viewData.name;
                      
                  }, 500);
                  
                  currentViewIndex = viewIndex;
              }
      
              // 更新UI按钮状态
              function updateUI(activeIndex) {
                  const buttons = document.querySelectorAll('.control-button');
                  buttons.forEach((button, index) => {
                      // 保持模型按钮状态独立（model 按钮有 id）
                      if (button.id === 'toggle-model-btn') return;
                      button.classList.toggle('active', index === activeIndex);
                  });
              }
      
              // 更新热点位置和目标
              function updateHotspots(hotspots) {
                  const hotspotsContainer = document.querySelector('#hotspots');
                  hotspotsContainer.innerHTML = '';
                  
                  hotspots.forEach((hotspot, index) => {
                      const hotspotEl = document.createElement('a-sphere');
                      hotspotEl.setAttribute('class', 'hotspot');
                      hotspotEl.setAttribute('position', hotspot.position);
                      hotspotEl.setAttribute('radius', '0.2');
                      hotspotEl.setAttribute('color', hotspot.color);
                      hotspotEl.setAttribute('material', 'opacity: 0.8');
                      hotspotEl.setAttribute('animation__mouseenter', {
                          property: 'scale',
                          to: '1.3 1.3 1.3',
                          startEvents: 'mouseenter',
                          dur: 200
                      });
                      hotspotEl.setAttribute('animation__mouseleave', {
                          property: 'scale',
                          to: '1 1 1',
                          startEvents: 'mouseleave',
                          dur: 200
                      });
                      
                      // 添加点击事件
                      hotspotEl.addEventListener('click', () => switchView(hotspot.target));
                      
                      // 添加文字标签
                      const textEl = document.createElement('a-text');
                      textEl.setAttribute('value', hotspot.label);
                      textEl.setAttribute('position', '0 0.5 0');
                      textEl.setAttribute('align', 'center');
                      textEl.setAttribute('color', 'white');
                      textEl.setAttribute('scale', '2 2 2');
                      textEl.setAttribute('billboard', 'true');
                      
                      hotspotEl.appendChild(textEl);
                      hotspotsContainer.appendChild(hotspotEl);
                  });
              }
      
              // 键盘导航支持
              document.addEventListener('keydown', (event) => {
                  switch(event.key) {
                      case '1':
                          switchView(0);
                          break;
                      case '2':
                          switchView(1);
                          break;
                      case '3':
                          switchView(2);
                          break;
                      case 'ArrowLeft':
                          switchView((currentViewIndex - 1 + viewsData.length) % viewsData.length);
                          break;
                      case 'ArrowRight':
                          switchView((currentViewIndex + 1) % viewsData.length);
                          break;
                  }
              });
      
              // 初始化热点
              document.addEventListener('DOMContentLoaded', () => {
                  updateHotspots(viewsData[0].hotspots);
              });
      
              // -----------------------
              // PLY 模型加载组件与切换逻辑
              // -----------------------
              AFRAME.registerComponent('ply-model', {
                  schema: {
                      src: { type: 'string' } // 支持 asset id (#meeting-ply) 或 url
                  },
                  init: function () {
                      const src = this.data.src;
                      const loader = new THREE.PLYLoader();
                      const el = this.el;
      
                      // Resolve URL: 如果使用 asset id（以#开头），取 asset 的 src 属性
                      let url = src;
                      if (src && src.startsWith('#')) {
                          const asset = document.querySelector(src);
                          if (asset) url = asset.getAttribute('src');
                      }
      
                      if (!url) {
                          console.warn('ply-model: no src provided');
                          return;
                      }
      
                      loader.load(url, (geometry) => {
                          geometry.computeVertexNormals();
                          const material = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.1, roughness: 0.8 });
                          const mesh = new THREE.Mesh(geometry, material);
      
                          // 初始缩放/旋转可根据模型调整
                          mesh.scale.set(0.01, 0.01, 0.01);
                          mesh.rotation.x = -Math.PI/2;
      
                          el.setObject3D('mesh', mesh);
                      }, undefined, (err) => {
                          console.error('PLY load error:', err);
                      });
                  },
                  remove: function () {
                      this.el.removeObject3D('mesh');
                  }
              });
      
              // 切换 PLY 模型显示/隐藏
              let modelVisible = false;
              function toggleModel() {
                  const btn = document.querySelector('#toggle-model-btn');
                  const scene = document.querySelector('a-scene');
      
                  const existing = document.querySelector('#meeting-model');
                  if (existing) {
                      existing.parentNode.removeChild(existing);
                      modelVisible = false;
                      btn.textContent = 'Show 3D Model';
                      btn.classList.remove('model-active');
                      return;
                  }
      
                  const modelEntity = document.createElement('a-entity');
                  modelEntity.setAttribute('id', 'meeting-model');
                  // 使用预加载的 asset id
                  modelEntity.setAttribute('ply-model', 'src: #meeting-ply');
                  // 放在相机前方 2 米处，可根据需要调整位置/缩放/旋转
                  modelEntity.setAttribute('position', '0 0 -2');
                  modelEntity.setAttribute('rotation', '0 0 0');
                  // scale 可以微调，组件内也做了基础缩放
                  modelEntity.setAttribute('scale', '1 1 1');
      
                  scene.appendChild(modelEntity);
                  modelVisible = true;
                  btn.textContent = 'Hide 3D Model';
                  btn.classList.add('model-active');
              }
          </script>
      </body>
      </html>
      <!-- ...existing code... -->      <!-- ...existing code... -->
      <!DOCTYPE html>
      <html>
      <head>
          <meta charset="utf-8">
          <title>Meeting Room</title>
          <meta name="description" content="Meeting Room">
          <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
          <style>
              body {
                  margin: 0;
                  font-family: Arial, sans-serif;
              }
              
              #ui-controls {
                  position: fixed;
                  top: 20px;
                  left: 20px;
                  z-index: 1000;
                  background: rgba(0, 0, 0, 0.7);
                  padding: 15px;
                  border-radius: 10px;
                  color: white;
              }
              
              .control-button {
                  background: #4CAF50;
                  border: none;
                  color: white;
                  padding: 10px 15px;
                  margin: 5px;
                  border-radius: 5px;
                  cursor: pointer;
                  font-size: 14px;
                  transition: background-color 0.3s;
              }
              
              .control-button:hover {
                  background: #45a049;
              }
              
              .control-button.active {
                  background: #FF6B6B;
              }
      
              /* 新按钮被打开时的样式 */
              .control-button.model-active {
                  background: #FFB74D;
              }
              
              #info {
                  position: fixed;
                  bottom: 20px;
                  left: 20px;
                  z-index: 1000;
                  background: rgba(0, 0, 0, 0.7);
                  padding: 10px;
                  border-radius: 5px;
                  color: white;
                  font-size: 14px;
              }
              
              .hotspot {
                  cursor: pointer;
                  transition: all 0.3s ease;
              }
              
              .hotspot:hover {
                  transform: scale(1.2);
              }
          </style>
      </head>
      <body>
              <!-- 返回首页按钮 -->
          <div id="back-to-index" style="position: fixed; top: 20px; right: 20px; z-index: 1100;">
              <button onclick="window.location.href='../index.html';"
                      style="background:#283644;color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-size:15px;">
                  Back to Home Page
              </button>
          </div>
      
          <!-- UI 控制面板 -->
          <div id="ui-controls">
              <h3 style="margin: 0 0 10px 0;">view switch</h3>
              <button class="control-button active" onclick="switchView(0)">view 1</button>
              <button class="control-button" onclick="switchView(1)">view 2</button>
              <button class="control-button" onclick="switchView(2)">view 3</button>
      
              <!-- 新增：显示/隐藏 3D PLY 模型按钮 -->
              <div style="margin-top:8px;">
                  <button id="toggle-model-btn" class="control-button" onclick="toggleModel()">Show 3D Model</button>
              </div>
          </div>
          
          <!-- 信息面板 -->
          <div id="info">
              <div>current view: <span id="current-view">view 1</span></div>
              <div>use the mouse to click and scroll, click buttons for view switch</div>
          </div>
      
          <a-scene vr-mode-ui="enabled: false" background="color: #000">
              <!-- 资源预加载 -->
              <a-assets>
                  <!-- 示例图片资源 - 请替换为你的实际图片路径 -->
                  <img id="view1" src="../images/meeting room/leave room.jpg" crossorigin="anonymous">
                  <img id="view2" src="../images/meeting room/meet_view2.jpg" crossorigin="anonymous">
                  <img id="view3" src="../images/meeting room/meet_view3.jpg" crossorigin="anonymous">
      
                  <!-- 新增：PLY 模型资源（路径可根据实际位置调整；若文件名有空格，请保留或改为无空格） -->
                  <a-asset-item id="meeting-ply" src="../models/Meeting%20Room.ply"></a-asset-item>
              </a-assets>
      
              <!-- 全景天空盒 -->
              <a-sky id="panorama" 
                     src="#view1" 
                     rotation="0 -130 0"
                     animation__fade="property: material.opacity; 
                                      to: 1; 
                                      dur: 1000; 
                                      easing: easeInOutQuad">
              </a-sky>
      
              <!-- 热点容器，必须添加 -->
              <a-entity id="hotspots"></a-entity>
      
              <!-- 摄像机和控制器 -->
              <a-entity id="cameraRig" position="0 1.6 0">
                  <a-camera 
                      look-controls="enabled: true; pointerLockEnabled: false"
                      wasd-controls="enabled: false"
                      cursor="rayOrigin: mouse"
                      raycaster="objects: .hotspot">
                  </a-camera>
              </a-entity>
      
              <!-- 光照 -->
              <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
              <!-- 为模型添加方向光以便更好观察 -->
              <a-light type="directional" color="#ffffff" intensity="0.8" position="0 5 5"></a-light>
          </a-scene>
      
          <!-- PLYLoader: 使用 three.js Examples 的加载器（依赖全局 THREE） -->
          <script src="https://threejs.org/examples/js/loaders/PLYLoader.js"></script>
      
          <script>
              // 全景图片数据配置
              const viewsData = [
                  {
                      name: "view 1",
                      image: "#view1",
                      rotation: "0 -130 0",
                      hotspots: [
                          { position: "3 0 -3", target: 1, color: "#FF6B6B", label: "view 2" },
                          { position: "-3 0 -3", target: 2, color: "#4ECDC4", label: "view 3" }
                      ]
                  },
                  {
                      name: "view 2", 
                      image: "#view2",
                      rotation: "0 -90 0",
                      hotspots: [
                          { position: "-3 0 -3", target: 0, color: "#96CEB4", label: "view 1" },
                          { position: "3 0 -3", target: 2, color: "#4ECDC4", label: "view 3" }
                      ]
                  },
                  {
                      name: "view 3",
                      image: "#view3", 
                      rotation: "0 0 0",
                      hotspots: [
                          { position: "3 0 3", target: 0, color: "#96CEB4", label: "view 1" },
                          { position: "-3 0 3", target: 1, color: "#FF6B6B", label: "view 2" }
                      ]
                  },
              ];
      
              let currentViewIndex = 0;
      
              // 切换view函数
              function switchView(viewIndex) {
                  if (viewIndex === currentViewIndex) return;
                  
                  const viewData = viewsData[viewIndex];
                  const panorama = document.querySelector('#panorama');
                  const currentViewSpan = document.querySelector('#current-view');
                  
                  // 淡出效果
                  panorama.setAttribute('animation__fadeout', {
                      property: 'material.opacity',
                      to: 0,
                      dur: 500,
                      easing: 'easeInOutQuad'
                  });
                  
                  // 延迟切换图片和淡入
                  setTimeout(() => {
                      panorama.setAttribute('src', viewData.image);
                      panorama.setAttribute('rotation', viewData.rotation);
                      
                      panorama.setAttribute('animation__fadein', {
                          property: 'material.opacity',
                          to: 1,
                          dur: 500,
                          easing: 'easeInOutQuad'
                      });
                      
                      // 更新UI
                      updateUI(viewIndex);
                      updateHotspots(viewData.hotspots);
                      currentViewSpan.textContent = viewData.name;
                      
                  }, 500);
                  
                  currentViewIndex = viewIndex;
              }
      
              // 更新UI按钮状态
              function updateUI(activeIndex) {
                  const buttons = document.querySelectorAll('.control-button');
                  buttons.forEach((button, index) => {
                      // 保持模型按钮状态独立（model 按钮有 id）
                      if (button.id === 'toggle-model-btn') return;
                      button.classList.toggle('active', index === activeIndex);
                  });
              }
      
              // 更新热点位置和目标
              function updateHotspots(hotspots) {
                  const hotspotsContainer = document.querySelector('#hotspots');
                  hotspotsContainer.innerHTML = '';
                  
                  hotspots.forEach((hotspot, index) => {
                      const hotspotEl = document.createElement('a-sphere');
                      hotspotEl.setAttribute('class', 'hotspot');
                      hotspotEl.setAttribute('position', hotspot.position);
                      hotspotEl.setAttribute('radius', '0.2');
                      hotspotEl.setAttribute('color', hotspot.color);
                      hotspotEl.setAttribute('material', 'opacity: 0.8');
                      hotspotEl.setAttribute('animation__mouseenter', {
                          property: 'scale',
                          to: '1.3 1.3 1.3',
                          startEvents: 'mouseenter',
                          dur: 200
                      });
                      hotspotEl.setAttribute('animation__mouseleave', {
                          property: 'scale',
                          to: '1 1 1',
                          startEvents: 'mouseleave',
                          dur: 200
                      });
                      
                      // 添加点击事件
                      hotspotEl.addEventListener('click', () => switchView(hotspot.target));
                      
                      // 添加文字标签
                      const textEl = document.createElement('a-text');
                      textEl.setAttribute('value', hotspot.label);
                      textEl.setAttribute('position', '0 0.5 0');
                      textEl.setAttribute('align', 'center');
                      textEl.setAttribute('color', 'white');
                      textEl.setAttribute('scale', '2 2 2');
                      textEl.setAttribute('billboard', 'true');
                      
                      hotspotEl.appendChild(textEl);
                      hotspotsContainer.appendChild(hotspotEl);
                  });
              }
      
              // 键盘导航支持
              document.addEventListener('keydown', (event) => {
                  switch(event.key) {
                      case '1':
                          switchView(0);
                          break;
                      case '2':
                          switchView(1);
                          break;
                      case '3':
                          switchView(2);
                          break;
                      case 'ArrowLeft':
                          switchView((currentViewIndex - 1 + viewsData.length) % viewsData.length);
                          break;
                      case 'ArrowRight':
                          switchView((currentViewIndex + 1) % viewsData.length);
                          break;
                  }
              });
      
              // 初始化热点
              document.addEventListener('DOMContentLoaded', () => {
                  updateHotspots(viewsData[0].hotspots);
              });
      
              // -----------------------
              // PLY 模型加载组件与切换逻辑
              // -----------------------
              AFRAME.registerComponent('ply-model', {
                  schema: {
                      src: { type: 'string' } // 支持 asset id (#meeting-ply) 或 url
                  },
                  init: function () {
                      const src = this.data.src;
                      const loader = new THREE.PLYLoader();
                      const el = this.el;
      
                      // Resolve URL: 如果使用 asset id（以#开头），取 asset 的 src 属性
                      let url = src;
                      if (src && src.startsWith('#')) {
                          const asset = document.querySelector(src);
                          if (asset) url = asset.getAttribute('src');
                      }
      
                      if (!url) {
                          console.warn('ply-model: no src provided');
                          return;
                      }
      
                      loader.load(url, (geometry) => {
                          geometry.computeVertexNormals();
                          const material = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.1, roughness: 0.8 });
                          const mesh = new THREE.Mesh(geometry, material);
      
                          // 初始缩放/旋转可根据模型调整
                          mesh.scale.set(0.01, 0.01, 0.01);
                          mesh.rotation.x = -Math.PI/2;
      
                          el.setObject3D('mesh', mesh);
                      }, undefined, (err) => {
                          console.error('PLY load error:', err);
                      });
                  },
                  remove: function () {
                      this.el.removeObject3D('mesh');
                  }
              });
      
              // 切换 PLY 模型显示/隐藏
              let modelVisible = false;
              function toggleModel() {
                  const btn = document.querySelector('#toggle-model-btn');
                  const scene = document.querySelector('a-scene');
      
                  const existing = document.querySelector('#meeting-model');
                  if (existing) {
                      existing.parentNode.removeChild(existing);
                      modelVisible = false;
                      btn.textContent = 'Show 3D Model';
                      btn.classList.remove('model-active');
                      return;
                  }
      
                  const modelEntity = document.createElement('a-entity');
                  modelEntity.setAttribute('id', 'meeting-model');
                  // 使用预加载的 asset id
                  modelEntity.setAttribute('ply-model', 'src: #meeting-ply');
                  // 放在相机前方 2 米处，可根据需要调整位置/缩放/旋转
                  modelEntity.setAttribute('position', '0 0 -2');
                  modelEntity.setAttribute('rotation', '0 0 0');
                  // scale 可以微调，组件内也做了基础缩放
                  modelEntity.setAttribute('scale', '1 1 1');
      
                  scene.appendChild(modelEntity);
                  modelVisible = true;
                  btn.textContent = 'Hide 3D Model';
                  btn.classList.add('model-active');
              }
          </script>
      </body>
      </html>
      <!-- ...existing code... -->
      camera-position
      info-message="htmlSrc: #messageText"
      environment="preset: egypt">
      <a-assets>
        <img id="thumbMeet" crossOrigin="anonymous" src="images/meeting room/leave room.jpg">
        <img id="thumbStudio1" crossOrigin="anonymous" src="images/Studio_1/01.jpg">
        <img id="thumbStudio2" crossOrigin="anonymous" src="images/Studio_2/01.jpg">
        <a-asset-item id="messageText" src="message.html"></a-asset-item>
      </a-assets>
      <a-link href="scenes/meeting.html" title="Meeting Room" position="-3.5 1.5 -1.0" image="#thumbMeet"></a-link>
      <a-link href="scenes/studio_1.html" title="Studio 1" position="0 1.5 -1.0" image="#thumbStudio1"></a-link>
      <a-link href="scenes/studio_2.html" title="Studio 2" position="3.5 1.5 -1.0" image="#thumbStudio2"></a-link>
      <a-entity light="type: point; color: #f4f4f4; intensity: 1.256; distance: 0" position="0 2 0"></a-entity>
      <a-entity id="leftHand" link-controls="hand: left"></a-entity>
      <a-entity id="rightHand" link-controls="hand: right"></a-entity>
    </a-scene>
  </body>
</html>
