<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Meeting Room</title>
    <meta name="description" content="Meeting Room">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        #ui-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
        }
        
        .control-button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .control-button:hover {
            background: #45a049;
        }
        
        .control-button.active {
            background: #FF6B6B;
        }
        
        #info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
        <!-- 返回首页按钮 -->
    <div id="back-to-index" style="position: fixed; top: 20px; right: 20px; z-index: 1100;">
        <button onclick="window.location.href='../index.html';"
                style="background:#283644;color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-size:15px;">
            Back to Home Page
        </button>
    </div>

    <!-- UI 控制面板 -->
    <div id="ui-controls">
        <h3 style="margin: 0 0 10px 0;">view switch</h3>
        <button class="control-button active" onclick="switchView(0)">view 1</button>
        <button class="control-button" onclick="switchView(1)">view 2</button>
        <button class="control-button" onclick="switchView(2)">view 3</button>

        <!-- 新增：前往 3D 场景 的按钮 -->
        <div style="margin-top:8px;">
            <button class="control-button" onclick="window.location.href='./meeting3d.html'">Open 3D View</button>
        </div>
    </div>
    
    <!-- 信息面板 -->
    <div id="info">
        <div>current view: <span id="current-view">view 1</span></div>
        <div>use the mouse to click and scroll, click buttons for view switch</div>
    </div>

    <a-scene vr-mode-ui="enabled: false" background="color: #000">
        <!-- 资源预加载 -->
        <a-assets>
            <!-- 示例图片资源 - 请替换为你的实际图片路径 -->
            <img id="view1" src="../images/meeting room/leave room.jpg" crossorigin="anonymous">
            <img id="view2" src="../images/meeting room/meet_view2.jpg" crossorigin="anonymous">
            <img id="view3" src="../images/meeting room/meet_view3.jpg" crossorigin="anonymous">
        </a-assets>

        <!-- 全景天空盒 -->
        <a-sky id="panorama" 
               src="#view1" 
               rotation="0 -90 0"
               animation__fade="property: material.opacity; 
                                to: 1; 
                                dur: 1000; 
                                easing: easeInOutQuad">
        </a-sky>

        <!-- 摄像机和控制器 -->
        <a-entity id="cameraRig" position="0 5 0" >
            <a-camera 
                look-controls="enabled: true; pointerLockEnabled: false"
                wasd-controls="enabled: false"
                cursor="rayOrigin: mouse">
            </a-camera>
        </a-entity>

        <!-- 光照 -->
        <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
    </a-scene>

    <script>
        // 全景图片数据配置
        const viewsData = [
            {
                name: "view 1",
                image: "#view1",
                rotation: "0 -130 0"
            },
            {
                name: "view 2", 
                image: "#view2",
                rotation: "0 -90 0"
            },
            {
                name: "view 3",
                image: "#view3", 
                rotation: "0 0 0"
            },
        ];

        let currentViewIndex = 0;

        // 切换view函数
        function switchView(viewIndex) {
            if (viewIndex === currentViewIndex) return;
            
            const viewData = viewsData[viewIndex];
            const panorama = document.querySelector('#panorama');
            const currentViewSpan = document.querySelector('#current-view');
            
            // 淡出效果
            panorama.setAttribute('animation__fadeout', {
                property: 'material.opacity',
                to: 0,
                dur: 500,
                easing: 'easeInOutQuad'
            });
            
            // 延迟切换图片和淡入
            setTimeout(() => {
                panorama.setAttribute('src', viewData.image);
                panorama.setAttribute('rotation', viewData.rotation);
                
                panorama.setAttribute('animation__fadein', {
                    property: 'material.opacity',
                    to: 1,
                    dur: 500,
                    easing: 'easeInOutQuad'
                });
                
                // 更新UI
                updateUI(viewIndex);
                currentViewSpan.textContent = viewData.name;
                
            }, 500);
            
            currentViewIndex = viewIndex;
        }

        // 更新UI按钮状态
        function updateUI(activeIndex) {
            const buttons = document.querySelectorAll('.control-button');
            buttons.forEach((button, index) => {
                button.classList.toggle('active', index === activeIndex);
            });
        }

        // 键盘导航支持
        document.addEventListener('keydown', (event) => {
            switch(event.key) {
                case '1':
                    switchView(0);
                    break;
                case '2':
                    switchView(1);
                    break;
                case '3':
                    switchView(2);
                    break;
                case 'ArrowLeft':
                    switchView((currentViewIndex - 1 + viewsData.length) % viewsData.length);
                    break;
                case 'ArrowRight':
                    switchView((currentViewIndex + 1) % viewsData.length);
                    break;
            }
        });

        // 初始化UI
        document.addEventListener('DOMContentLoaded', () => {
            // 可以在这里设置初始UI状态，如果需要的话
            updateUI(currentViewIndex);
        });
    </script>
</body>
</html>