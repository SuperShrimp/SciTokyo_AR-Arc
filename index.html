<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>360Â° Image Gallery - Office Spaces</title>
    <meta name="description" content="360Â° Image Gallery - Office Spaces">
    
    <!-- A-Frameæ ¸å¿ƒåº“ -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-template-component@3.x.x/dist/aframe-template-component.min.js"></script>
    <script src="https://unpkg.com/aframe-layout-component@5.x.x/dist/aframe-layout-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.x.x/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-proxy-event-component@2.1.0/dist/aframe-proxy-event-component.min.jss"></script>
    
    <!-- ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ -->
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      
      /* ç§»åŠ¨ç«¯UIæ§åˆ¶é¢æ¿ */
      .mobile-controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        display: flex;
        gap: 10px;
        background: rgba(0,0,0,0.7);
        padding: 10px;
        border-radius: 25px;
        backdrop-filter: blur(10px);
      }
      
      .room-btn {
        padding: 8px 16px;
        background: rgba(255,255,255,0.2);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        user-select: none;
      }
      
      .room-btn:hover, .room-btn.active {
        background: rgba(255,255,255,0.4);
        transform: scale(1.05);
      }
      
      /* VRæŒ‰é’®æ ·å¼ */
      .vr-button {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        padding: 10px 15px;
        background: rgba(0,0,0,0.8);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
      }
      
      /* æç¤ºæ–‡å­— */
      .instruction {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        color: white;
        background: rgba(0,0,0,0.7);
        padding: 10px;
        border-radius: 5px;
        font-size: 12px;
        max-width: 200px;
      }
      
      /* éšè—åœ¨å°å±å¹•ä¸Šçš„å…ƒç´  */
      @media (max-width: 768px) {
        .instruction {
          font-size: 10px;
          padding: 5px;
          max-width: 150px;
        }
      }
    </style>
    
    <!-- å›¾ç‰‡é“¾æ¥æ¨¡æ¿ -->
    <script id="link" type="text/html">
      <a-entity class="link"
        geometry="primitive: plane; height: 1; width: 1"
        material="shader: flat; src: ${thumb}"
        sound="on: click; src: #click-sound"
        event-set__mouseenter="scale: 1.2 1.2 1"
        event-set__mouseleave="scale: 1 1 1"
        event-set__click="_target: #image-360; _delay: 300; material.src: ${src}"
        proxy-event="event: click; to: #image-360; as: fade"></a-entity>
    </script>
  </head>
  <body>
    <!-- ç§»åŠ¨ç«¯æ§åˆ¶é¢æ¿ -->
    <div class="mobile-controls">
      <button class="room-btn active" onclick="switchRoom('m_lab')">M Lab</button>
      <button class="room-btn" onclick="switchRoom('kitchen')">Kitchen</button>
      <button class="room-btn" onclick="switchRoom('meeting_room')">Meeting Room</button>
    </div>
    
    <!-- ä½¿ç”¨æç¤º -->
    <div class="instruction">
      ğŸ“± æ‰‹æœºï¼šè§¦æ‘¸æ‹–æ‹½æ—‹è½¬è§†è§’<br>
      ğŸ–±ï¸ ç”µè„‘ï¼šé¼ æ ‡æ‹–æ‹½æˆ–WASDé”®
    </div>
    
    <!-- VRæ¨¡å¼æŒ‰é’® -->
    <button class="vr-button" onclick="enterVR()">ğŸ¥½ VR Mode</button>

    <a-scene 
      vr-mode-ui="enabled: true" 
      device-orientation-permission-ui="enabled: true"
      background="color: #000"
      renderer="antialias: true; colorManagement: true"
      loading-screen="dotsColor: white; backgroundColor: #000">
      
      <a-assets>
        <!-- æ‚¨çš„è‡ªå®šä¹‰å›¾ç‰‡ -->
        <img id="m_lab" crossorigin="anonymous" src="images/m_lab.jpg">
        <img id="kitchen" crossorigin="anonymous" src="images/kitchen.jpg">
        <img id="meeting_room" crossorigin="anonymous" src="images/meeting_room.jpg">
        
        <!-- å¤‡ç”¨å›¾ç‰‡ -->
        <img id="city" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg">
        <img id="cubes" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/cubes.jpg">
        <img id="sechelt" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
        
        <!-- ç¼©ç•¥å›¾ -->
        <img id="m_lab-thumb" crossorigin="anonymous" src="thumb_images/thumb_lab.jpg">
        <img id="kitchen-thumb" crossorigin="anonymous" src="thumb_images/thumb_kitchen.jpg">
        <img id="meeting_room-thumb" crossorigin="anonymous" src="thumb_images/thumb_mr.jpg">
        
        <!-- å¤‡ç”¨ç¼©ç•¥å›¾ -->
        <img id="city-thumb" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/thumb-city.jpg">
        <img id="cubes-thumb" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/thumb-cubes.jpg">
        <img id="sechelt-thumb" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/thumb-sechelt.jpg">
        
        <!-- éŸ³æ•ˆ -->
        <audio id="click-sound" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"></audio>
      </a-assets>

      <!-- 360åº¦å…¨æ™¯å›¾ç‰‡ -->
      <a-sky 
        id="image-360" 
        radius="10" 
        src="#m_lab"
        animation__fade="property: components.material.material.color; type: color; from: #FFF; to: #000; dur: 300; startEvents: fade"
        animation__fadeback="property: components.material.material.color; type: color; from: #000; to: #FFF; dur: 300; startEvents: animationcomplete__fade">
      </a-sky>

      <!-- å›¾ç‰‡é“¾æ¥ç¼©ç•¥å›¾ -->
      <a-entity id="links" layout="type: line; margin: 1.5" position="-1.5 -1 -4">
        <a-entity template="src: #link" data-src="#m_lab" data-thumb="#m_lab-thumb"></a-entity>
        <a-entity template="src: #link" data-src="#kitchen" data-thumb="#kitchen-thumb"></a-entity>
        <a-entity template="src: #link" data-src="#meeting_room" data-thumb="#meeting_room-thumb"></a-entity>
      </a-entity>

      <!-- è¯´æ˜æ–‡å­— -->
      <a-text 
        id="room-title"
        value="W8E-7 Floor - M Lab" 
        position="0 2 -4" 
        align="center" 
        color="#FFF" 
        scale="1.5 1.5 1.5"
        geometry="primitive: plane; width: 6; height: 1"
        material="color: rgba(0,0,0,0.5)">
      </a-text>

      <!-- æ‘„åƒæœºé…ç½® - ç§»åŠ¨ç«¯ä¼˜åŒ– -->
      <a-entity 
        id="cameraRig" 
        camera 
        look-controls="enabled: true; reverseMouseDrag: false; touchEnabled: true; magicWindowTrackingEnabled: true"
        wasd-controls="enabled: true; acceleration: 20"
        position="0 1.6 0">
        
        <!-- å…‰æ ‡ - ç§»åŠ¨ç«¯ä¼˜åŒ– -->
        <a-cursor
          id="cursor"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
          material="color: white; shader: flat; opacity: 0.8"
          animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
          animation__mouseenter="property: scale; startEvents: mouseenter; to: 1.3 1.3 1.3; dur: 150"
          animation__mouseleave="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 150"
          raycaster="objects: .link; far: 20">
        </a-cursor>
      </a-entity>
    </a-scene>

    <script>
      // æˆ¿é—´åˆ‡æ¢åŠŸèƒ½
      function switchRoom(roomId) {
        const sky = document.querySelector('#image-360');
        const title = document.querySelector('#room-title');
        const buttons = document.querySelectorAll('.room-btn');
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // åˆ‡æ¢åœºæ™¯
        sky.setAttribute('src', '#' + roomId);
        
        // æ›´æ–°æ ‡é¢˜
        const roomNames = {
          'm_lab': 'W8E-7 Floor - M Lab',
          'kitchen': 'W8E-7 Floor - Kitchen', 
          'meeting_room': 'W8E-7 Floor - Meeting Room'
        };
        title.setAttribute('value', roomNames[roomId]);
        
        // æ’­æ”¾åˆ‡æ¢éŸ³æ•ˆ
        const sound = document.querySelector('#click-sound');
        if (sound) sound.components.sound.playSound();
      }
      
      // è¿›å…¥VRæ¨¡å¼
      function enterVR() {
        const scene = document.querySelector('a-scene');
        if (scene.enterVR) {
          scene.enterVR();
        }
      }
      
      // ç§»åŠ¨ç«¯æ–¹å‘ä¼ æ„Ÿå™¨æ”¯æŒ
      if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', function(event) {
          // å¯ç”¨è®¾å¤‡æ–¹å‘æ§åˆ¶
        });
      }
      
      // é˜²æ­¢ç§»åŠ¨ç«¯é¡µé¢æ»šåŠ¨
      document.addEventListener('touchmove', function(e) {
        e.preventDefault();
      }, { passive: false });
      
      // å…¨å±æ”¯æŒ
      document.addEventListener('dblclick', function() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      });
      
      // æ£€æµ‹å›¾ç‰‡åŠ è½½é”™è¯¯ï¼Œä½¿ç”¨å¤‡ç”¨å›¾ç‰‡
      const images = ['m_lab', 'kitchen', 'meeting_room'];
      const backupImages = ['city', 'cubes', 'sechelt'];
      
      images.forEach((img, index) => {
        const imgElement = document.querySelector('#' + img);
        const thumbElement = document.querySelector('#' + img + '-thumb');
        
        imgElement.addEventListener('error', function() {
          console.log('Loading backup image for', img);
          this.src = document.querySelector('#' + backupImages[index]).src;
        });
        
        thumbElement.addEventListener('error', function() {
          this.src = document.querySelector('#' + backupImages[index] + '-thumb').src;
        });
      });
    </script>
  </body>
</html>